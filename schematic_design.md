# 远心镜头阵列大尺寸精密测量系统方案设计

## 项目背景
对于大尺寸阀体零件的测量，传统的透视成像相机虽然具备较大的视场范围，但由于阀体上的待测轮廓存在明显的高度差，即使经过精密标定，透视相机因成像存在透视畸变，仍难以实现高精度尺寸测量。为克服这一问题，可采用远心镜头进行平行成像，避免透视误差。然而，远心镜头的视场范围较小，难以覆盖整个零件区域。因此，本方案采用 2×2 的远心镜头阵列进行成像，以实现对大尺寸区域的高精度测量。

对于大尺寸阀体零件上的圆孔结构，可根据孔径大小采用不同测量方式：对于小孔（最小直径为 8.1 mm），使用单个远心相机即可完成精密测量；而对于大孔（最大直径达 307 mm），可分别使用阵列中的四个远心镜头对圆孔的四个区域进行成像，并通过高精度图像拼接重建完整圆孔结构，从而实现高精度尺寸测量。

## 设计目标
- 单相机测量小圆孔，误差小于10μm。
- 阵列相机测量大圆孔，误差小于20μm。
- 拼接视野范围可覆盖整体零件（最大307mm）。
- 无畸变成像，即对透视误差进行有效矫正。
- 标定流程简便，可复现。

## 系统组成
### 远心镜头DTCM111-80H-AL
- 双侧远心
- 最大靶面1.1''
- 像方畸变<0.1%
- 物方工作距228±4mm
- 物方远心度<0.1°

### 相机MV-CH250-90GC
- 5120×5120分辨率彩色
- 靶面尺寸1.1''
- 最大帧率4.5fps
- 像元尺寸2.5μm×2.5μm

### halcon标定板GB050-2.5-7×7
- 图案尺寸40×40mm
- 标志点直径2.5mm
- 中心距5mm
- 阵列7×7

## 核心技术路线
为实现对大尺寸零件的高精度成像与无缝拼接，本系统设计将围绕远心光学成像、相机阵列协同布置、多视角图像拼接与校准、系统同步控制等多个关键技术点展开，确保系统整体的测量精度、稳定性与可重复性。主要包括以下几方面：

### 1. 远心成像系统设计
传统镜头存在透视畸变，尤其在大尺寸零件的边缘位置容易产生几何形变，不利于尺寸测量与图像拼接，另外考虑到镜头与传感器之间的倾斜会导致测量出现误差。为避免上述问题，采用双侧远心镜头进行成像。远心镜头在视野范围内可保证所有入射光线近似平行，使得物体尺寸在图像中不随物距变化而改变，适合高精度测量。相较普通镜头，成像比例一致，有利于拼接时的几何一致性。远心镜头通常具有较大的景深，适合对凹凸不平或深度变化的工件进行稳定成像。远心镜头需根据目标尺寸、相机分辨率、测量精度、工作距离等进行匹配设计，确定放大倍率及视野范围。

### 2. 相机阵列布局规划
单台相机的视野有限，对于大尺寸孔径的测量，无法覆盖整个工件，因此需设计多相机阵列系统进行并排拼接成像。每台相机覆盖一定宽度，整体拼接后覆盖全尺寸区域，无重叠视场。安装时使用水平仪确保相机光轴近似垂直于待测平面，微小倾斜后期可通过相机标定去除。

### 3. 标定与拼接算法
单相机内参标定：获取每台相机的畸变参数、放大率和倾斜角等，用于后期图像的几何校正及拼接。使用halcon及圆点标定板进行标定。

相机间外参标定：将所有相机的图像统一到一个坐标系中，或将所有的相机坐标系进行统一，用于图像的精密拼接。对于远心成像，不涉及透视变换，可以用单应性矩阵的乘积及SVD分解求得。

图像拼接：根据外参关系计算图像的相对位置，还包括图像的几何旋转、亮度均衡等算法及亚像素精细。

### 4. 相机同步触发及模块封装
同步触发：通过采集卡同步软触发，确保图像之间的时间一致性。

模块封装：对标定、采集、拼接等模块进行封装，确保程序线程的安全。

## 系统搭建与校准流程
### 1. 相机选型及安装位置计算
已知待测孔径最小为8.1mm，最大为307mm，

### 2. 内外参标定算法
内参的标定可用halcon的标定工具箱，其包含了双侧远心镜头的标定及倾斜校正算法。对每个相机拍摄不同位姿的标定板，且确保标定板覆盖到了相机的每个边缘，单个相机需拍摄20张以上图片，通过标定工具箱可得到单相机的放大倍率、畸变参数以及倾斜角。

外参的标定可以使用PnP算法求变换矩阵，由于系统采用远心相机，故求得矩阵应为3×3仿射变换矩阵，外参标定步骤如下：

首先需要四个已知位置的标定板，四个标定板的位置均在统一坐标系下，用四个相机分别拍摄四个标定板，提取其角点坐标并记录其相对位置。

可先确定一个主相机，然后将子相机的图像变换到主相机的图像坐标系。使用PnP算法求得每个相机的仿射变换矩阵，则图像之间的变换关系即为：xxxxxxxxxxxxxxxxxxx

利用变换关系将子相机的三幅图变换至主相机图像中即可。

该变换关系只要相机的位置恒定，可适用于任意图片，因此内外参的标定结果有：畸变参数、倾斜角度、放大倍率以及仿射变换矩阵，其对于任意图像，均可通过图像操作进行拼接。

### 3. 图像拼接算法

### 4. 测量实验及误差校验


